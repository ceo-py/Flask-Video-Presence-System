# Flask-Video-Presence-System

## Overview

**Flask-Video-Presence-System** is a real-time video streaming system that allows you to stream multiple RTSP cameras and display them in a retro-style user interface. The backend is built using Flask to handle API requests and stream video data, while the frontend uses HTML, JavaScript, and HLS.js to display camera feeds in a grid layout.

## Features

* Stream RTSP video from cameras.
* Supports multiple cameras.
* Retro-style UI with matrix-like effects.
* Play/pause and fullscreen controls for each camera.
* Dynamic addition/removal of cameras from the UI.
* Auto-terminate streaming process when no viewers are connected for a certain period.

## Requirements

* Python 3.x
* Flask
* Flask-CORS
* python-dotenv
* FFmpeg (for RTSP to HLS conversion)
* Web browser (supports HLS playback like Chrome, Firefox, Safari)

## Installation

### Backend Setup

1. **Clone the repository:**

   ```bash
   git clone https://github.com/ceo-py/Flask-Video-Presence-System.git
   cd Flask-Video-Presence-System
   ```

2. **Set up a virtual environment:**

   ```bash
   python3 -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install the required Python dependencies:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Set up environment variables:**

   Create a `.env` file in the root of your project and add the following:

   ```env
   camera1=rtsp://your-camera-1-url
   camera2=rtsp://your-camera-2-url
   ```

   Replace `rtsp://your-camera-1-url` and `rtsp://your-camera-2-url` with the actual RTSP stream URLs of your cameras.

5. **Start the Flask application:**

   ```bash
   python server.py
   ```

   The server should now be running on `http://127.0.0.1:5000`.

### Frontend Setup

1. **Open the HTML file in a browser:**

   You can open the `index.html` file in your preferred web browser. The frontend will communicate with the backend to fetch and display the camera streams.

2. **Use the interface:**

   * **Add Cameras**: Click the "+ Add Camera" button to dynamically add more cameras to the UI.
   * **Control Streams**: You can click the "▶" button to start the stream, the "■" button to stop it, and the "⤢" button to toggle fullscreen.

### Frontend Dependencies

The frontend makes use of **HLS.js** for streaming video using the HLS protocol. The script is dynamically imported and used for browsers that support HLS.

## API Endpoints

### 1. **GET `/api/allCameras`**

Returns a list of all camera names.

**Response Example:**

```json
["Test1", "Test2"]
```

### 2. **POST `/api/viewer`**

Records the last viewer interaction for a camera. It expects a JSON payload with the camera name.

**Request Body:**

```json
{
  "camera": "Test1"
}
```

**Response:**

```text
"ok"
```

### 3. **GET `/api/start/<camera_name>`**

Starts streaming a camera by its name. If the camera is not already streaming, it will start the stream and return the stream URL.

**Response Example:**

```json
{
  "url": "/streams/Test1/index.m3u8"
}
```

### 4. **GET `/api/stop/<camera_name>`**

Stops the streaming of a camera.

**Response:**

```text
"stopped"
```

### 5. **GET `/streams/<filename>`**

Serves the `.m3u8` playlist or `.ts` segments from the `/var/www/html/streams` directory. These files are generated by FFmpeg when the stream is started.

---

## Running in Production

For production use, you will need to deploy both the backend (Flask) and the frontend in a more robust environment:

* **Backend**: Deploy Flask using a WSGI server like **Gunicorn** behind **Nginx** or **Apache**.
* **Frontend**: Serve the static HTML and JavaScript through Nginx or Apache for production environments.

You may also want to secure the stream with SSL and ensure the cameras' RTSP streams are accessible either over a VPN or through proper firewall settings.

---

## Troubleshooting

### Camera not streaming

* Ensure the RTSP URL is correct and accessible from the server.
* Check the FFmpeg logs for any errors related to stream encoding or network access.

### 404 Errors on `/streams/<filename>`

* Check if the `.m3u8` file and `.ts` segments are being generated in the correct directory (`/var/www/html/streams`).
* Ensure that the `ffmpeg` command is correctly running and producing the stream files.

---

## License

This project is licensed under the MIT License.

---

### Additional Notes

* You can expand this project by adding more features like user authentication, stream recording, or more advanced video processing.
* The system is designed to be lightweight and responsive, using a simple web interface and a basic Flask backend.

---

This README provides a complete guide to setting up and using your **Flask-Video-Presence-System** project. You can extend and modify it as necessary to suit your specific use case or features. Let me know if you need any changes or further explanations!
